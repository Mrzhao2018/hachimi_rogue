# Hachimi_Rogue

一个基于 Python 和 tcod 库开发的 Roguelike 游戏项目。本项目展示了从基础框架到完整游戏系统的渐进式开发过程。

## 环境要求

- Python 3.8+
- tcod 库
- numpy

## 安装

1. 克隆项目到本地
2. 创建虚拟环境：
   ```bash
   python -m venv .venv
   ```

3. 激活虚拟环境：
   - Windows: `.venv\Scripts\activate`
   - Linux/Mac: `source .venv/bin/activate`

4. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

## 运行

在激活虚拟环境后运行：
```bash
python main.py
```

## VS Code 设置

项目包含了 VS Code 的配置文件，会自动：
- 设置 Python 解释器为项目虚拟环境
- 在终端中自动激活虚拟环境
- 推荐安装 Python 扩展

打开项目后，VS Code 会提示安装推荐的扩展。接受安装后，新建的终端会自动激活虚拟环境。

## 游戏控制

- 方向键/WASD/Vi键：移动角色
- 数字键盘：移动角色（支持八方向）
- 句号(.)或数字键盘5：等待一回合
- ESC：退出游戏

## 游戏特性

- **回合制战斗**: 玩家与敌人轮流行动
- **视野系统**: 动态光照和视野计算
- **随机地图**: 程序化生成的地下城
- **战斗系统**: 攻击、防御和生命值管理
- **敌人AI**: 智能寻路和战斗行为

## 版本更新历史

### v0.8.0 (2025-09-26) - UI系统与API兼容性增强
**提交哈希**: `ef7230b`

**主要特性**:
- **消息日志系统**: 添加完整的游戏消息记录和显示功能
  - 实现 `MessageLog` 类管理游戏消息历史
  - 支持消息历史查看器 (`HistoryViewer`)
  - 按 'V' 键查看完整消息历史
- **UI渲染增强**:
  - 添加生命值条显示 (`render_bar`)
  - 鼠标悬停显示实体名称 (`render_names_at_mouse_location`)
  - 颜色系统支持 (`color.py`)
- **鼠标交互**: 完善鼠标位置跟踪和交互功能
- **API兼容性修复**:
  - 修复 `event.tile` 弃用警告，改用 `event.position`
  - 更新键盘常量从 `tcod.event.K_*` 到 `tcod.event.KeySym.*`
  - 修复 `tcod.Console` 和 `tcod.CENTER` 弃用问题
- **类型系统优化**: 解决 float 与 int 类型转换问题

**技术改进**:
- 8个文件修改，新增 UI 和消息系统
- 完全兼容最新版本 tcod 库
- 更好的用户体验和交互反馈

### v0.7.0 (2025-09-26) - 架构重构与组件系统
**提交哈希**: `0c00a46`

**主要特性**:
- **修复循环导入问题**: 解决了 `entity.py` 和 `game_map.py` 之间的循环导入依赖
- **统一命名规范**: 将所有 `gamemap` 参数统一为 `game_map`，提高代码一致性
- **组件系统架构**: 
  - 创建 `components` 包，实现模块化组件系统
  - 添加 `Fighter` 组件处理战斗属性和生命值管理
  - 添加 `BaseAI` 组件处理 AI 行为
  - 实现组件基类 `BaseComponent`
- **事件处理优化**:
  - 修复 `Engine.event_handler` 类型注解问题
  - 添加 `GameOverEventHandler` 处理游戏结束状态
  - 消除 `ev_keyup` RuntimeWarning
- **渲染系统**: 添加 `RenderOrder` 枚举管理渲染层级
- **类型系统完善**: 解决多项类型检查错误和警告

**技术改进**:
- 15个文件修改，390行新增，101行删除
- 完善的包结构和相对导入支持
- 更好的代码组织和模块化设计

### v0.6.0 (2025-09-25) - 动作系统重构与可扩展性增强
**提交哈希**: `688b54b`

**主要特性**:
- **动作系统重构**: 将 Action 类与 Entity 绑定，提高系统一致性
- **实体管理优化**: 改进实体的生成、放置和移动逻辑
- **事件处理增强**: 完善事件分发机制，提升处理效率
- **引擎架构优化**: 简化引擎结构，提高可扩展性

**技术改进**:
- 7个文件修改，131行新增，75行删除
- 更清晰的职责分离
- 更好的代码可维护性

### v0.5.0 (2025-09-25) - 战斗系统与实体生成
**提交哈希**: `12e0824`

**主要特性**:
- **近战战斗系统**: 实现 `MeleeAction` 和 `BumpAction` 
- **智能碰撞检测**: 区分攻击和移动行为
- **实体工厂**: 添加 `entity_factories.py` 统一管理实体模板
- **敌人AI**: 实现基础的敌人回合处理逻辑
- **地图实体管理**: 优化实体在地图上的生成和放置

**技术改进**:
- 8个文件修改，143行新增，28行删除
- 更完整的游戏玩法循环
- 模块化的实体创建系统

### v0.4.0 (2025-09-25) - 视野系统与地图生成
**提交哈希**: `7e51711`

**主要特性**:
- **视野计算**: 集成 tcod 的 FOV (Field of View) 算法
- **地图生成器**: 实现 `procgen.py` 随机地下城生成
- **房间系统**: 添加矩形房间生成和连接隧道
- **光照系统**: 区分已探索和当前可见区域
- **地形优化**: 增强 `tile_types.py` 支持透明度属性

**技术改进**:
- 5个文件修改，155行新增，10行删除
- 完整的地图生成管线
- 真实的游戏世界体验

### v0.3.0 (2025-09-25) - 游戏引擎与核心架构
**提交哈希**: `02eb622`

**主要特性**:
- **游戏引擎**: 创建 `Engine` 类统一管理游戏状态
- **实体系统**: 实现 `Entity` 类处理游戏对象
- **地图系统**: 添加 `GameMap` 类管理地图数据
- **动作系统扩展**: 增强动作执行逻辑
- **地形系统**: 创建 `tile_types.py` 定义地形属性

**技术改进**:
- 7个文件修改，172行新增，30行删除
- 清晰的 MVC 架构模式
- 可扩展的系统设计

### v0.2.0 (2025-09-25) - 事件处理系统
**提交哈希**: `d066cc9`

**主要特性**:
- **自定义事件分发**: 替换 tcod 的 EventDispatch 为自定义实现
- **键盘输入处理**: 支持多种键盘布局（方向键、数字键盘、Vi键）
- **动作映射**: 实现键盘输入到游戏动作的映射
- **主循环优化**: 完善游戏主循环的事件处理流程

**技术改进**:
- 2个文件修改，79行新增，5行删除
- 更灵活的事件处理机制
- 更好的输入响应性

### v0.1.0 (2025-09-25) - 项目初始化
**提交哈希**: `2f721ae`

**主要特性**:
- **项目基础架构**: 设置基本的项目结构和配置
- **VS Code 集成**: 配置开发环境和推荐扩展
- **基础依赖**: 设置 tcod 和 numpy 依赖
- **初始框架**: 创建基本的 `main.py`、`actions.py` 和 `input_handlers.py`
- **资源文件**: 添加游戏字体资源

**技术基础**:
- 9个文件创建，135行代码
- 完整的开发环境配置
- 基础的游戏框架结构

## 技术架构

### 核心组件

- **Engine**: 游戏主引擎，管理游戏状态和主循环
- **GameMap**: 地图系统，处理地形、实体和视野
- **Entity/Actor**: 实体系统，管理玩家和敌人
- **Actions**: 动作系统，处理游戏逻辑和行为
- **Components**: 组件系统，模块化功能实现
  - `Fighter`: 战斗属性和生命值管理
  - `BaseAI`: AI 行为和寻路算法
- **EventHandlers**: 事件处理系统，管理输入和游戏状态

### 技术特点

- **模块化设计**: 清晰的组件分离和职责划分
- **类型安全**: 完整的类型注解和静态检查支持  
- **事件驱动**: 灵活的事件处理和动作系统
- **可扩展性**: 易于添加新功能和游戏内容
- **开发友好**: 完善的 VS Code 集成和调试支持

## 开发路线图

- [ ] 物品系统和背包管理
- [ ] 技能和法术系统
- [ ] 更多敌人类型和AI行为
- [ ] 楼层系统和进度保存
- [ ] 音效和更丰富的视觉效果
- [ ] 平衡性调整和游戏性优化

## 贡献

欢迎提交 Issue 和 Pull Request！

## 许可证

本项目采用 MIT 许可证。
